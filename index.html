<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ronzer G2 - AI Chat</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* CSS Variables for theming */
        :root {
            --primary-color: #0078ff;
            --primary-dark: #005fcc;
            --bg-color: #f7f7f8;
            --sidebar-bg: #ffffff;
            --text-color: #111111;
            --text-light: #666666;
            --border-color: #e3e3e3;
            --user-bubble: #0078ff;
            --ai-bubble: #ffffff;
            --shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            --radius: 12px;
            --transition: all 0.3s ease;
        }

        .dark-mode {
            --primary-color: #0078ff;
            --primary-dark: #005fcc;
            --bg-color: #1a1a1a;
            --sidebar-bg: #2d2d2d;
            --text-color: #f0f0f0;
            --text-light: #a0a0a0;
            --border-color: #404040;
            --user-bubble: #0078ff;
            --ai-bubble: #3d3d3d;
            --shadow: 0 2px 12px rgba(0, 0, 0, 0.3);
        }

        /* Reset and Base Styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            overflow: hidden;
            transition: var(--transition);
        }

        /* Layout */
        .app-container {
            display: flex;
            height: 100vh;
            position: relative;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background-color: var(--sidebar-bg);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            transition: var(--transition);
            z-index: 100;
        }

        .sidebar-header {
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar-title {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--primary-color);
        }

        .new-chat-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--radius);
            padding: 10px 16px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            justify-content: center;
            margin: 10px 16px;
        }

        .new-chat-btn:hover {
            background: var(--primary-dark);
        }

        .search-container {
            padding: 10px 16px;
        }

        .search-input {
            width: 100%;
            padding: 10px 12px;
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 0.9rem;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .history-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px 16px;
        }

        .history-item {
            padding: 12px;
            border-radius: var(--radius);
            margin-bottom: 8px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .history-item:hover {
            background-color: rgba(0, 120, 255, 0.1);
        }

        .history-item.active {
            background-color: rgba(0, 120, 255, 0.15);
            border-left: 3px solid var(--primary-color);
        }

        .history-title {
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
        }

        .history-actions {
            display: none;
            gap: 5px;
        }

        .history-item:hover .history-actions {
            display: flex;
        }

        .history-action-btn {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            font-size: 0.8rem;
            padding: 4px;
            border-radius: 4px;
        }

        .history-action-btn:hover {
            background-color: rgba(0, 0, 0, 0.1);
            color: var(--text-color);
        }

        .sidebar-footer {
            padding: 16px;
            border-top: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .footer-btn {
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            padding: 8px 12px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .footer-btn:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .dark-mode .footer-btn:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        /* Main Chat Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .chat-header {
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--sidebar-bg);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .menu-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--text-color);
            display: none;
        }

        .chat-title {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #4CAF50;
        }

        .header-right {
            display: flex;
            gap: 10px;
        }

        .header-btn {
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            padding: 6px 10px;
            border-radius: var(--radius);
            transition: var(--transition);
        }

        .header-btn:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .dark-mode .header-btn:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        /* Messages Area */
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            scroll-behavior: smooth;
        }

        .message {
            max-width: 85%;
            display: flex;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            align-self: flex-end;
        }

        .message.ai {
            align-self: flex-start;
        }

        .message-bubble {
            padding: 12px 16px;
            border-radius: var(--radius);
            line-height: 1.5;
            position: relative;
            box-shadow: var(--shadow);
        }

        .message.user .message-bubble {
            background-color: var(--user-bubble);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.ai .message-bubble {
            background-color: var(--ai-bubble);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-bottom-left-radius: 4px;
        }

        .message-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            opacity: 0;
            transition: var(--transition);
        }

        .message:hover .message-actions {
            opacity: 1;
        }

        .message-action-btn {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 4px;
            transition: var(--transition);
        }

        .message-action-btn:hover {
            background-color: rgba(0, 0, 0, 0.05);
            color: var(--text-color);
        }

        .dark-mode .message-action-btn:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .typing-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: var(--text-light);
            animation: typingPulse 1.5s infinite ease-in-out;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingPulse {
            0%, 60%, 100% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            30% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Input Area */
        .input-container {
            padding: 16px;
            border-top: 1px solid var(--border-color);
            background-color: var(--sidebar-bg);
        }

        .input-wrapper {
            display: flex;
            align-items: flex-end;
            gap: 10px;
            max-width: 768px;
            margin: 0 auto;
        }

        .input-field {
            flex: 1;
            padding: 12px 16px;
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 1rem;
            resize: none;
            max-height: 150px;
            min-height: 44px;
            transition: var(--transition);
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0, 120, 255, 0.1);
        }

        .input-actions {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .input-action-btn {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            padding: 6px;
            border-radius: 4px;
            transition: var(--transition);
        }

        .input-action-btn:hover {
            background-color: rgba(0, 0, 0, 0.05);
            color: var(--text-color);
        }

        .dark-mode .input-action-btn:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .send-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--radius);
            padding: 10px 16px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .send-btn:hover {
            background: var(--primary-dark);
        }

        .send-btn:disabled {
            background-color: var(--text-light);
            cursor: not-allowed;
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background-color: var(--sidebar-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: var(--transition);
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--text-light);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .modal-btn {
            padding: 8px 16px;
            border-radius: var(--radius);
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }

        .modal-btn.primary {
            background: var(--primary-color);
            color: white;
        }

        .modal-btn.primary:hover {
            background: var(--primary-dark);
        }

        .modal-btn.secondary {
            background: none;
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }

        .modal-btn.secondary:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .dark-mode .modal-btn.secondary:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        /* Settings */
        .settings-section {
            margin-bottom: 20px;
        }

        .settings-section-title {
            font-weight: 600;
            margin-bottom: 12px;
            font-size: 1rem;
        }

        .settings-option {
            margin-bottom: 16px;
        }

        .settings-label {
            display: block;
            margin-bottom: 6px;
            font-size: 0.9rem;
        }

        .settings-input, .settings-select {
            width: 100%;
            padding: 10px 12px;
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 0.9rem;
        }

        .settings-input:focus, .settings-select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: var(--transition);
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary-color);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        /* Split Panel */
        .split-panel {
            position: fixed;
            right: 0;
            top: 0;
            bottom: 0;
            width: 300px;
            background-color: var(--sidebar-bg);
            border-left: 1px solid var(--border-color);
            transform: translateX(100%);
            transition: var(--transition);
            z-index: 50;
            display: flex;
            flex-direction: column;
        }

        .split-panel.active {
            transform: translateX(0);
        }

        .split-panel-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .split-panel-title {
            font-weight: 600;
        }

        .split-panel-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--text-light);
        }

        .split-panel-body {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
        }

        .system-prompt-textarea {
            width: 100%;
            min-height: 200px;
            padding: 12px;
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 0.9rem;
            resize: vertical;
        }

        .system-prompt-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        /* Welcome Screen */
        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .welcome-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            color: var(--primary-color);
        }

        .welcome-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .welcome-subtitle {
            font-size: 1.1rem;
            color: var(--text-light);
            margin-bottom: 30px;
        }

        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .quick-action-btn {
            background: var(--sidebar-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 10px 16px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .quick-action-btn:hover {
            background-color: rgba(0, 120, 255, 0.1);
            border-color: var(--primary-color);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                bottom: 0;
                transform: translateX(-100%);
                box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .menu-btn {
                display: block;
            }

            .message {
                max-width: 95%;
            }

            .split-panel {
                width: 100%;
            }
        }

        /* Markdown Styling */
        .message-bubble pre {
            background-color: rgba(0, 0, 0, 0.05);
            padding: 10px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 10px 0;
            font-size: 0.85rem;
        }

        .dark-mode .message-bubble pre {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .message-bubble code {
            background-color: rgba(0, 0, 0, 0.05);
            padding: 2px 4px;
            border-radius: 4px;
            font-size: 0.85rem;
        }

        .dark-mode .message-bubble code {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .message-bubble ul, .message-bubble ol {
            margin: 10px 0;
            padding-left: 20px;
        }

        .message-bubble blockquote {
            border-left: 3px solid var(--primary-color);
            padding-left: 10px;
            margin: 10px 0;
            color: var(--text-light);
        }

        .message-bubble table {
            border-collapse: collapse;
            width: 100%;
            margin: 10px 0;
        }

        .message-bubble th, .message-bubble td {
            border: 1px solid var(--border-color);
            padding: 8px;
            text-align: left;
        }

        .message-bubble th {
            background-color: rgba(0, 0, 0, 0.03);
        }

        .dark-mode .message-bubble th {
            background-color: rgba(255, 255, 255, 0.05);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">Ronzer G2</div>
            </div>
            
            <button class="new-chat-btn" id="newChatBtn">
                <i class="fas fa-plus"></i> New Chat
            </button>
            
            <div class="search-container">
                <input type="text" class="search-input" id="searchInput" placeholder="Search chats...">
            </div>
            
            <div class="history-list" id="historyList">
                <!-- Chat history will be populated here -->
            </div>
            
            <div class="sidebar-footer">
                <button class="footer-btn" id="memoryPanelBtn">
                    <i class="fas fa-brain"></i> Memory Panel
                </button>
                <button class="footer-btn" id="settingsBtn">
                    <i class="fas fa-cog"></i> Settings
                </button>
                <button class="footer-btn" id="darkModeToggle">
                    <i class="fas fa-moon"></i> Dark Mode
                </button>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <div class="chat-header">
                <div class="header-left">
                    <button class="menu-btn" id="menuBtn">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="chat-title" id="chatTitle">New Chat</div>
                    <div class="status-indicator" id="statusIndicator"></div>
                </div>
                
                <div class="header-right">
                    <button class="header-btn" id="voiceInputBtn" title="Voice Input">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button class="header-btn" id="aboutBtn" title="About">
                        <i class="fas fa-info-circle"></i>
                    </button>
                </div>
            </div>
            
            <div class="messages-container" id="messagesContainer">
                <div class="welcome-screen" id="welcomeScreen">
                    <div class="welcome-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <h1 class="welcome-title">Ronzer G2</h1>
                    <p class="welcome-subtitle">Your intelligent assistant powered by advanced AI systems</p>
                    
                    <div class="quick-actions">
                        <button class="quick-action-btn" data-command="/summarize">Summarize document</button>
                        <button class="quick-action-btn" data-command="/rewrite">Rewrite text</button>
                        <button class="quick-action-btn" data-command="/explain">Explain concept</button>
                        <button class="quick-action-btn" data-command="/translate">Translate text</button>
                    </div>
                </div>
            </div>
            
            <div class="input-container">
                <div class="input-wrapper">
                    <div class="input-actions">
                        <button class="input-action-btn" id="ttsToggle" title="Text-to-Speech">
                            <i class="fas fa-volume-up"></i>
                        </button>
                    </div>
                    
                    <textarea class="input-field" id="messageInput" placeholder="Message Ronzer G2... (Enter to send, Ctrl+Enter for new line)" rows="1"></textarea>
                    
                    <button class="send-btn" id="sendBtn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Split Panel for Memory/System Prompts -->
        <div class="split-panel" id="splitPanel">
            <div class="split-panel-header">
                <div class="split-panel-title">Memory Panel</div>
                <button class="split-panel-close" id="splitPanelClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="split-panel-body">
                <p>Add instructions that Ronzer G2 should remember throughout this conversation:</p>
                <textarea class="system-prompt-textarea" id="systemPrompt" placeholder="E.g., Always respond in a formal tone, or Always provide code examples in Python"></textarea>
            </div>
        </div>
        
        <!-- About Modal -->
        <div class="modal-overlay" id="aboutModal">
            <div class="modal">
                <div class="modal-header">
                    <div class="modal-title">About Ronzer G2</div>
                    <button class="modal-close" id="closeAboutModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="modal-body">
                    <p><strong>Name:</strong> Ronzer G2</p>
                    <p><strong>Created by:</strong> RonzDavil</p>
                    <p><strong>Powered by:</strong> Advanced AI Systems</p>
                </div>
                
                <div class="modal-footer">
                    <button class="modal-btn primary" id="confirmAboutModal">OK</button>
                </div>
            </div>
        </div>
        
        <!-- Settings Modal -->
        <div class="modal-overlay" id="settingsModal">
            <div class="modal">
                <div class="modal-header">
                    <div class="modal-title">Settings</div>
                    <button class="modal-close" id="closeSettingsModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="modal-body">
                    <div class="settings-section">
                        <div class="settings-section-title">Appearance</div>
                        
                        <div class="settings-option">
                            <label class="settings-label">Dark Mode</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="darkModeSwitch">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-option">
                            <label class="settings-label" for="fontSize">Font Size</label>
                            <select class="settings-select" id="fontSize">
                                <option value="small">Small</option>
                                <option value="medium" selected>Medium</option>
                                <option value="large">Large</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <div class="settings-section-title">AI Settings</div>
                        
                        <div class="settings-option">
                            <label class="settings-label" for="modelSelect">Response Mode</label>
                            <select class="settings-select" id="modelSelect">
                                <option value="balanced">Balanced</option>
                                <option value="creative">Creative</option>
                                <option value="precise">Precise</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <div class="settings-section-title">Data Management</div>
                        
                        <div class="settings-option">
                            <button class="modal-btn secondary" id="exportChatsBtn">Export Chats</button>
                            <button class="modal-btn secondary" id="importChatsBtn">Import Chats</button>
                            <button class="modal-btn secondary" id="clearAllChatsBtn">Clear All Chats</button>
                        </div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button class="modal-btn secondary" id="cancelSettingsModal">Cancel</button>
                    <button class="modal-btn primary" id="saveSettingsBtn">Save</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Main application state
        const state = {
            chats: JSON.parse(localStorage.getItem('ronzerG2_chats')) || [],
            activeChatIndex: 0,
            settings: JSON.parse(localStorage.getItem('ronzerG2_settings')) || {
                darkMode: false,
                fontSize: 'medium',
                model: 'balanced',
                ttsEnabled: false
            },
            isGenerating: false,
            voiceRecognition: null,
            speechSynthesis: window.speechSynthesis || null
        };

        // DOM Elements
        const elements = {
            sidebar: document.getElementById('sidebar'),
            menuBtn: document.getElementById('menuBtn'),
            newChatBtn: document.getElementById('newChatBtn'),
            searchInput: document.getElementById('searchInput'),
            historyList: document.getElementById('historyList'),
            memoryPanelBtn: document.getElementById('memoryPanelBtn'),
            settingsBtn: document.getElementById('settingsBtn'),
            darkModeToggle: document.getElementById('darkModeToggle'),
            chatTitle: document.getElementById('chatTitle'),
            statusIndicator: document.getElementById('statusIndicator'),
            voiceInputBtn: document.getElementById('voiceInputBtn'),
            aboutBtn: document.getElementById('aboutBtn'),
            messagesContainer: document.getElementById('messagesContainer'),
            welcomeScreen: document.getElementById('welcomeScreen'),
            messageInput: document.getElementById('messageInput'),
            ttsToggle: document.getElementById('ttsToggle'),
            sendBtn: document.getElementById('sendBtn'),
            splitPanel: document.getElementById('splitPanel'),
            splitPanelClose: document.getElementById('splitPanelClose'),
            systemPrompt: document.getElementById('systemPrompt'),
            aboutModal: document.getElementById('aboutModal'),
            closeAboutModal: document.getElementById('closeAboutModal'),
            confirmAboutModal: document.getElementById('confirmAboutModal'),
            settingsModal: document.getElementById('settingsModal'),
            closeSettingsModal: document.getElementById('closeSettingsModal'),
            cancelSettingsModal: document.getElementById('cancelSettingsModal'),
            saveSettingsBtn: document.getElementById('saveSettingsBtn'),
            darkModeSwitch: document.getElementById('darkModeSwitch'),
            fontSize: document.getElementById('fontSize'),
            modelSelect: document.getElementById('modelSelect'),
            exportChatsBtn: document.getElementById('exportChatsBtn'),
            importChatsBtn: document.getElementById('importChatsBtn'),
            clearAllChatsBtn: document.getElementById('clearAllChatsBtn')
        };

        // Initialize the application
        function init() {
            // Apply saved settings
            applySettings();
            
            // Initialize chat history
            if (state.chats.length === 0) {
                createNewChat();
            } else {
                renderChatHistory();
                renderActiveChat();
            }
            
            // Set up event listeners
            setupEventListeners();
            
            // Initialize voice recognition if available
            initVoiceRecognition();
            
            // Set status to online
            updateStatus('online');
        }

        // Apply user settings
        function applySettings() {
            // Dark mode
            if (state.settings.darkMode) {
                document.body.classList.add('dark-mode');
                elements.darkModeSwitch.checked = true;
            }
            
            // Font size
            document.body.style.fontSize = state.settings.fontSize === 'small' ? '14px' : 
                                         state.settings.fontSize === 'large' ? '18px' : '16px';
            elements.fontSize.value = state.settings.fontSize;
            
            // Model selection
            elements.modelSelect.value = state.settings.model;
            
            // TTS toggle
            elements.ttsToggle.classList.toggle('active', state.settings.ttsEnabled);
        }

        // Set up all event listeners
        function setupEventListeners() {
            // Sidebar toggle
            elements.menuBtn.addEventListener('click', toggleSidebar);
            
            // New chat
            elements.newChatBtn.addEventListener('click', createNewChat);
            
            // Search chats
            elements.searchInput.addEventListener('input', filterChats);
            
            // Memory panel
            elements.memoryPanelBtn.addEventListener('click', toggleMemoryPanel);
            elements.splitPanelClose.addEventListener('click', toggleMemoryPanel);
            
            // Settings
            elements.settingsBtn.addEventListener('click', openSettingsModal);
            elements.darkModeToggle.addEventListener('click', toggleDarkMode);
            
            // About modal
            elements.aboutBtn.addEventListener('click', openAboutModal);
            elements.closeAboutModal.addEventListener('click', closeAboutModal);
            elements.confirmAboutModal.addEventListener('click', closeAboutModal);
            elements.aboutModal.addEventListener('click', (e) => {
                if (e.target === elements.aboutModal) closeAboutModal();
            });
            
            // Settings modal
            elements.closeSettingsModal.addEventListener('click', closeSettingsModal);
            elements.cancelSettingsModal.addEventListener('click', closeSettingsModal);
            elements.saveSettingsBtn.addEventListener('click', saveSettings);
            elements.exportChatsBtn.addEventListener('click', exportChats);
            elements.importChatsBtn.addEventListener('click', importChats);
            elements.clearAllChatsBtn.addEventListener('click', clearAllChats);
            
            // Voice input
            elements.voiceInputBtn.addEventListener('click', toggleVoiceInput);
            
            // TTS toggle
            elements.ttsToggle.addEventListener('click', toggleTTS);
            
            // Message input and sending
            elements.messageInput.addEventListener('input', autoResizeTextarea);
            elements.messageInput.addEventListener('keydown', handleKeydown);
            elements.sendBtn.addEventListener('click', sendMessage);
            
            // Quick action buttons
            document.querySelectorAll('.quick-action-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const command = e.target.getAttribute('data-command');
                    elements.messageInput.value = command + ' ';
                    elements.messageInput.focus();
                });
            });
            
            // System prompt saving
            elements.systemPrompt.addEventListener('blur', saveSystemPrompt);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', handleKeyboardShortcuts);
        }

        // Toggle sidebar visibility (mobile)
        function toggleSidebar() {
            elements.sidebar.classList.toggle('active');
        }

        // Create a new chat
        function createNewChat() {
            const newChat = {
                id: Date.now(),
                title: 'New Chat',
                messages: [],
                systemPrompt: '',
                createdAt: new Date().toISOString()
            };
            
            state.chats.unshift(newChat);
            state.activeChatIndex = 0;
            
            saveChats();
            renderChatHistory();
            renderActiveChat();
            
            // Close sidebar on mobile
            if (window.innerWidth <= 768) {
                elements.sidebar.classList.remove('active');
            }
        }

        // Filter chats based on search input
        function filterChats() {
            const searchTerm = elements.searchInput.value.toLowerCase();
            const historyItems = elements.historyList.querySelectorAll('.history-item');
            
            historyItems.forEach(item => {
                const title = item.querySelector('.history-title').textContent.toLowerCase();
                if (title.includes(searchTerm)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Toggle memory panel
        function toggleMemoryPanel() {
            elements.splitPanel.classList.toggle('active');
        }

        // Save system prompt for active chat
        function saveSystemPrompt() {
            if (state.chats[state.activeChatIndex]) {
                state.chats[state.activeChatIndex].systemPrompt = elements.systemPrompt.value;
                saveChats();
            }
        }

        // Open about modal
        function openAboutModal() {
            elements.aboutModal.classList.add('active');
        }

        // Close about modal
        function closeAboutModal() {
            elements.aboutModal.classList.remove('active');
        }

        // Open settings modal
        function openSettingsModal() {
            elements.settingsModal.classList.add('active');
        }

        // Close settings modal
        function closeSettingsModal() {
            elements.settingsModal.classList.remove('active');
        }

        // Save settings
        function saveSettings() {
            state.settings.darkMode = elements.darkModeSwitch.checked;
            state.settings.fontSize = elements.fontSize.value;
            state.settings.model = elements.modelSelect.value;
            
            localStorage.setItem('ronzerG2_settings', JSON.stringify(state.settings));
            applySettings();
            closeSettingsModal();
        }

        // Toggle dark mode
        function toggleDarkMode() {
            state.settings.darkMode = !state.settings.darkMode;
            localStorage.setItem('ronzerG2_settings', JSON.stringify(state.settings));
            applySettings();
        }

        // Toggle TTS
        function toggleTTS() {
            state.settings.ttsEnabled = !state.settings.ttsEnabled;
            localStorage.setItem('ronzerG2_settings', JSON.stringify(state.settings));
            elements.ttsToggle.classList.toggle('active', state.settings.ttsEnabled);
        }

        // Initialize voice recognition
        function initVoiceRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                state.voiceRecognition = new SpeechRecognition();
                state.voiceRecognition.continuous = false;
                state.voiceRecognition.interimResults = false;
                
                state.voiceRecognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    elements.messageInput.value = transcript;
                    autoResizeTextarea();
                };
                
                state.voiceRecognition.onerror = (event) => {
                    console.error('Speech recognition error', event.error);
                    updateStatus('error');
                    setTimeout(() => updateStatus('online'), 3000);
                };
            } else {
                elements.voiceInputBtn.style.display = 'none';
            }
        }

        // Toggle voice input
        function toggleVoiceInput() {
            if (state.voiceRecognition) {
                try {
                    state.voiceRecognition.start();
                    elements.voiceInputBtn.classList.add('recording');
                    updateStatus('recording');
                    
                    state.voiceRecognition.onend = () => {
                        elements.voiceInputBtn.classList.remove('recording');
                        updateStatus('online');
                    };
                } catch (error) {
                    console.error('Error starting voice recognition:', error);
                }
            }
        }

        // Auto-resize textarea based on content
        function autoResizeTextarea() {
            elements.messageInput.style.height = 'auto';
            elements.messageInput.style.height = Math.min(elements.messageInput.scrollHeight, 150) + 'px';
        }

        // Handle keydown events in message input
        function handleKeydown(e) {
            if (e.key === 'Enter') {
                if (e.ctrlKey || e.metaKey) {
                    // Ctrl+Enter adds new line
                    e.preventDefault();
                    const start = elements.messageInput.selectionStart;
                    const end = elements.messageInput.selectionEnd;
                    elements.messageInput.value = elements.messageInput.value.substring(0, start) + '\n' + elements.messageInput.value.substring(end);
                    elements.messageInput.selectionStart = elements.messageInput.selectionEnd = start + 1;
                    autoResizeTextarea();
                } else {
                    // Enter sends message
                    e.preventDefault();
                    sendMessage();
                }
            }
        }

        // Handle global keyboard shortcuts
        function handleKeyboardShortcuts(e) {
            // Ctrl+Shift+N - New chat
            if (e.ctrlKey && e.shiftKey && e.key === 'N') {
                e.preventDefault();
                createNewChat();
            }
            
            // Ctrl+Shift+C - Clear chat
            if (e.ctrlKey && e.shiftKey && e.key === 'C') {
                e.preventDefault();
                clearActiveChat();
            }
            
            // Escape - Close modals or sidebar
            if (e.key === 'Escape') {
                if (elements.aboutModal.classList.contains('active')) {
                    closeAboutModal();
                } else if (elements.settingsModal.classList.contains('active')) {
                    closeSettingsModal();
                } else if (elements.splitPanel.classList.contains('active')) {
                    toggleMemoryPanel();
                } else if (elements.sidebar.classList.contains('active')) {
                    toggleSidebar();
                }
            }
        }

        // Send message
        function sendMessage() {
            const messageText = elements.messageInput.value.trim();
            if (!messageText || state.isGenerating) return;
            
            // Add user message to chat
            addMessageToChat('user', messageText);
            
            // Clear input
            elements.messageInput.value = '';
            autoResizeTextarea();
            
            // Show typing indicator
            showTypingIndicator();
            
            // Generate AI response (simulated for this example)
            setTimeout(generateAIResponse, 1000);
        }

        // Add message to active chat
        function addMessageToChat(role, content) {
            if (!state.chats[state.activeChatIndex]) return;
            
            const message = {
                role,
                content,
                timestamp: new Date().toISOString()
            };
            
            state.chats[state.activeChatIndex].messages.push(message);
            
            // Update chat title if it's the first user message
            if (role === 'user' && state.chats[state.activeChatIndex].messages.length === 1) {
                state.chats[state.activeChatIndex].title = content.substring(0, 30) + (content.length > 30 ? '...' : '');
                elements.chatTitle.textContent = state.chats[state.activeChatIndex].title;
            }
            
            saveChats();
            renderActiveChat();
        }

        // Show typing indicator
        function showTypingIndicator() {
            state.isGenerating = true;
            elements.sendBtn.disabled = true;
            
            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'message ai';
            typingIndicator.innerHTML = `
                <div class="message-bubble">
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            
            elements.messagesContainer.appendChild(typingIndicator);
            elements.messagesContainer.scrollTop = elements.messagesContainer.scrollHeight;
        }

        // Remove typing indicator
        function removeTypingIndicator() {
            const typingIndicator = elements.messagesContainer.querySelector('.typing-indicator');
            if (typingIndicator) {
                typingIndicator.closest('.message').remove();
            }
        }

        // Generate AI response (simulated)
        function generateAIResponse() {
            removeTypingIndicator();
            
            // In a real implementation, this would call an AI API
            const responses = [
                "I understand your question. Based on my analysis, the solution would involve implementing a structured approach with clear milestones.",
                "That's an interesting point. From my perspective, the key factors to consider are scalability, maintainability, and user experience.",
                "I'd be happy to help with that. Let me break down the process into manageable steps that you can follow.",
                "Based on the information provided, I recommend a multi-phase approach that addresses both immediate and long-term requirements."
            ];
            
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            
            // Add AI message to chat
            addMessageToChat('assistant', randomResponse);
            
            // Enable text-to-speech if enabled
            if (state.settings.ttsEnabled && state.speechSynthesis) {
                speakText(randomResponse);
            }
            
            state.isGenerating = false;
            elements.sendBtn.disabled = false;
        }

        // Text-to-speech function
        function speakText(text) {
            if (state.speechSynthesis) {
                const utterance = new SpeechSynthesisUtterance(text);
                state.speechSynthesis.speak(utterance);
            }
        }

        // Update status indicator
        function updateStatus(status) {
            const indicator = elements.statusIndicator;
            indicator.style.backgroundColor = 
                status === 'online' ? '#4CAF50' :
                status === 'recording' ? '#FF9800' :
                status === 'error' ? '#F44336' : '#9E9E9E';
        }

        // Render chat history in sidebar
        function renderChatHistory() {
            elements.historyList.innerHTML = '';
            
            state.chats.forEach((chat, index) => {
                const historyItem = document.createElement('div');
                historyItem.className = `history-item ${index === state.activeChatIndex ? 'active' : ''}`;
                historyItem.innerHTML = `
                    <div class="history-title">${chat.title}</div>
                    <div class="history-actions">
                        <button class="history-action-btn edit-btn" title="Rename">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="history-action-btn delete-btn" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                historyItem.addEventListener('click', (e) => {
                    if (!e.target.closest('.history-actions')) {
                        state.activeChatIndex = index;
                        renderChatHistory();
                        renderActiveChat();
                        
                        // Close sidebar on mobile
                        if (window.innerWidth <= 768) {
                            elements.sidebar.classList.remove('active');
                        }
                    }
                });
                
                // Edit button
                const editBtn = historyItem.querySelector('.edit-btn');
                editBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    renameChat(index);
                });
                
                // Delete button
                const deleteBtn = historyItem.querySelector('.delete-btn');
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteChat(index);
                });
                
                elements.historyList.appendChild(historyItem);
            });
        }

        // Render active chat
        function renderActiveChat() {
            elements.messagesContainer.innerHTML = '';
            
            if (state.chats[state.activeChatIndex] && state.chats[state.activeChatIndex].messages.length > 0) {
                elements.welcomeScreen.style.display = 'none';
                
                state.chats[state.activeChatIndex].messages.forEach(message => {
                    renderMessage(message.role, message.content);
                });
                
                // Load system prompt
                elements.systemPrompt.value = state.chats[state.activeChatIndex].systemPrompt || '';
            } else {
                elements.welcomeScreen.style.display = 'flex';
            }
            
            // Update chat title
            elements.chatTitle.textContent = state.chats[state.activeChatIndex]?.title || 'New Chat';
            
            // Scroll to bottom
            elements.messagesContainer.scrollTop = elements.messagesContainer.scrollHeight;
        }

        // Render a single message
        function renderMessage(role, content) {
            const messageElement = document.createElement('div');
            messageElement.className = `message ${role}`;
            
            // Simple markdown parsing (in a real app, use a proper library)
            const formattedContent = content
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/`(.*?)`/g, '<code>$1</code>');
            
            messageElement.innerHTML = `
                <div class="message-bubble">${formattedContent}</div>
                <div class="message-actions">
                    <button class="message-action-btn copy-btn" title="Copy">
                        <i class="fas fa-copy"></i>
                    </button>
                    ${role === 'assistant' ? `
                        <button class="message-action-btn regenerate-btn" title="Regenerate">
                            <i class="fas fa-redo"></i>
                        </button>
                    ` : ''}
                </div>
            `;
            
            // Copy button
            const copyBtn = messageElement.querySelector('.copy-btn');
            copyBtn.addEventListener('click', () => {
                navigator.clipboard.writeText(content).then(() => {
                    // Show copied feedback
                    const originalIcon = copyBtn.innerHTML;
                    copyBtn.innerHTML = '<i class="fas fa-check"></i>';
                    setTimeout(() => {
                        copyBtn.innerHTML = originalIcon;
                    }, 2000);
                });
            });
            
            // Regenerate button (for AI messages)
            if (role === 'assistant') {
                const regenerateBtn = messageElement.querySelector('.regenerate-btn');
                regenerateBtn.addEventListener('click', () => {
                    // In a real implementation, this would regenerate the response
                    alert('Regenerate functionality would be implemented with the AI API');
                });
            }
            
            elements.messagesContainer.appendChild(messageElement);
        }

        // Rename a chat
        function renameChat(index) {
            const newTitle = prompt('Enter new chat title:', state.chats[index].title);
            if (newTitle && newTitle.trim()) {
                state.chats[index].title = newTitle.trim();
                saveChats();
                renderChatHistory();
                
                if (index === state.activeChatIndex) {
                    elements.chatTitle.textContent = newTitle.trim();
                }
            }
        }

        // Delete a chat
        function deleteChat(index) {
            if (confirm('Are you sure you want to delete this chat?')) {
                state.chats.splice(index, 1);
                
                if (state.chats.length === 0) {
                    createNewChat();
                } else if (state.activeChatIndex >= index && state.activeChatIndex > 0) {
                    state.activeChatIndex--;
                }
                
                saveChats();
                renderChatHistory();
                renderActiveChat();
            }
        }

        // Clear active chat
        function clearActiveChat() {
            if (state.chats[state.activeChatIndex]) {
                state.chats[state.activeChatIndex].messages = [];
                saveChats();
                renderActiveChat();
            }
        }

        // Clear all chats
        function clearAllChats() {
            if (confirm('Are you sure you want to delete all chats? This action cannot be undone.')) {
                state.chats = [];
                createNewChat();
            }
        }

        // Export chats as JSON
        function exportChats() {
            const dataStr = JSON.stringify(state.chats, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `ronzer-g2-chats-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        // Import chats from JSON
        function importChats() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const importedChats = JSON.parse(event.target.result);
                        if (Array.isArray(importedChats)) {
                            state.chats = importedChats;
                            state.activeChatIndex = 0;
                            saveChats();
                            renderChatHistory();
                            renderActiveChat();
                            alert('Chats imported successfully!');
                        } else {
                            alert('Invalid file format. Please select a valid Ronzer G2 export file.');
                        }
                    } catch (error) {
                        alert('Error importing chats: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }

        // Save chats to localStorage
        function saveChats() {
            localStorage.setItem('ronzerG2_chats', JSON.stringify(state.chats));
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
